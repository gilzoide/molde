<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>molde</h1>




<h2>Topics</h2>
<ul class="">
  <li><strong>README</strong></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../index.html">molde</a></li>
</ul>

</div>

<div id="content">


<h1>Molde</h1>
<p><a href="https://travis-ci.org/gilzoide/molde"><img src="https://travis-ci.org/gilzoide/molde.svg?branch=master" alt="Build Status"/></a></p>

<p>Molde is a template engine for Lua 5.1+. It compiles a template string to a
function that generates the final string by substituting values by the ones in
a sandboxed environment.</p>


<h2>Templates</h2>
<p>There are 3 constructs templates recognize:</p>

<ul>
    <li><strong>Literals</strong>: Content that will be copied unmodified to the final string.
    Read the <a href="#note-on-long-strings">note on long strings</a></li>
    <li><strong>Value</strong>: A value processed by Lua and appended to the final string,
    stringified by <a href="https://www.lua.org/manual/5.3/manual.html#pdf-tostring">tostring</a></li>
    <li><strong>Statement</strong>: A Lua code block to be copied unmodified to the generated code,
    used for variable assignments, repetitions, conditions, etc. It doesn't
    directly generate contents for the final string</li>
</ul>

<p><strong>Values</strong> are delimited by matching <code>{{</code> and <code>}}</code>, <strong>statements</strong> by <code>{%</code> and
<code>%}</code>, and everything else is considered <strong>literal</strong>. Delimiter characters <code>{</code>,
<code>}</code> and <code>%</code> can be escaped using a leading backslash. If you want literal <code>}}</code>
or <code>%}</code> in your template, they <strong>must</strong> be escaped, or <em>molde</em> will return
error.</p>

<p>Example:</p>

<pre><code> NOTE: This is not a valid molde template for educational purposes.

 By default, everything is copied unmodified to the final string.

 Values are just Lua expressions:
 - Hello {{ "world" }}
   "Hello world"
 - {{ 5 + 3 * 4 }}
   "17"
 - {{ nil or "default" }}
   "default"
 - You are using {{ _VERSION }}
   "You are using Lua 5.3" (You may use Lua 5.1 and 5.2 as well)
 - Line 1{{ "\n" }}Line 2
   "Line 1
   Line 2"
 - Escaping \{{ Hi! \}} (Note that you MUST escape the closing '}}')
   "Escaping {{ Hi! }}"
 - Escaping is characterwise, so \{{ is as valid as {\{
   "Escaping is characterwise, so {{ is as valid as {{"
 - table.insert is used in values {{ so they must be a valid expression! }}
   Error: ')' expected near 'they'

 Statements are Lua statements:
 - {% for i = 1, 5 do %}{{ i }} {% end %}
   "1 2 3 4 5 "
 - {% -- this is just a comment, y'know %}
   ""
 - {{ unbound_variable }}{% unbound_variable = "Hi!" %} {{ unbound_variable }}
   "nil Hi!"
 - {% if false then %}This will never be printed{% else %}Conditionals!{% end %}
   "Conditionals!"
 - \{% Escaping works \%} {\% here as well %\} (You MUST escape closing '%}' too)
   "{% Escaping works %} {% here as well %}"
 - {% if without_then %}Statements must form valid Lua code!{% end %}
   Error: 'then' expected near 'table'
</code></pre>



<h2>Note on long strings</h2>
<p>The lua reference manual says:</p>


<pre>
For convenience, when the opening long bracket is immediately
followed by a newline, the newline is <span class="keyword">not</span> included <span class="keyword">in</span> the <span class="global">string</span>.
</pre>

<p>The code generated by molde to insert literals uses long strings, so newlines
that come immediately after a closing value or statement <strong>will not</strong> be
considered in the final string.</p>


<h2>Installing</h2>
<p>Using <a href="https://luarocks.org/">LuaRocks</a>:</p>


<pre>
# luarocks install molde
</pre>

<p>Or you may copy the only source file <code>molde.lua</code> to your Lua path</p>



<h2>Using</h2>

<pre>
<span class="keyword">local</span> molde = <span class="global">require</span> <span class="string">'molde'</span>

<span class="comment">-- molde.load and molde.loadfile return a function that receives a table
</span><span class="comment">-- with the values to substitute, and the optional environment (default: _G)
</span>hello_template = molde.<span class="global">load</span>(<span class="string">[[Hello {{ name or "world" }}]]</span>)
<span class="global">print</span>(hello_template()) <span class="comment">-- "Hello world"
</span><span class="global">print</span>(hello_template{name = <span class="string">"gilzoide"</span>}) <span class="comment">-- "Hello gilzoide"
</span>name = <span class="string">"gilzoide"</span>
<span class="global">print</span>(hello_template({}, _ENV <span class="keyword">or</span> getfenv())) <span class="comment">-- "Hello gilzoide"
</span>
<span class="comment">-- load the template from a file (same template)
</span>hello_template = molde.<span class="global">loadfile</span>(<span class="string">"hello_template"</span>)
name = <span class="keyword">nil</span>
<span class="global">print</span>(hello_template()) <span class="comment">-- "Hello world"</span>
</pre>




<h2>Testing</h2>
<p>Run automated tests using <a href="http://olivinelabs.com/busted/">busted</a>:</p>


<pre>
$ busted
</pre>

<h2>Documentation</h2>
<p>The API is documented using <a href="https://github.com/stevedonovan/LDoc">LDoc</a> and
is available at <a href="http://gilzoide.github.io/molde">github pages</a>.</p>

<p>To generate:</p>


<pre>
$ ldoc ldoc/ -d docs
</pre>

<h2>Change log</h2>

<ul>
    <li>1.0.1 - Fix error handling for matching on LpegLabel v1.5</li>
    <li>1.0.0 - Updated to use LpegLabel version 1.5+</li>
    <li>0.1.6 - Support for Lua 5.1</li>
</ul>



</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2018-06-03 19:54:19 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
